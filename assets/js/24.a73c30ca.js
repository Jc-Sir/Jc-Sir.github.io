(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{508:function(t,s,a){t.exports=a.p+"assets/img/eventloop.2cb08d5d.png"},637:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"js-事件循环机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#js-事件循环机制"}},[t._v("#")]),t._v(" js 事件循环机制")]),t._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#javascript-为什么是单线程的"}},[t._v("JAVASCRIPT 为什么是单线程的?")])]),n("li",[n("a",{attrs:{href:"#什么是异步"}},[t._v("什么是异步")])]),n("li",[n("a",{attrs:{href:"#为什么需要异步"}},[t._v("为什么需要异步？")])]),n("li",[n("a",{attrs:{href:"#单线程又是如何实现异步的呢"}},[t._v("单线程又是如何实现异步的呢?")])]),n("li",[n("a",{attrs:{href:"#宏任务-微任务"}},[t._v("宏任务&微任务")]),n("ul",[n("li",[n("a",{attrs:{href:"#宏任务-macro-task"}},[t._v("宏任务（macro-task）")])]),n("li",[n("a",{attrs:{href:"#微任务-micro-task"}},[t._v("微任务（micro-task）")])]),n("li",[n("a",{attrs:{href:"#执行顺序"}},[t._v("执行顺序")])])])])])]),n("p"),t._v(" "),n("h2",{attrs:{id:"javascript-为什么是单线程的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript-为什么是单线程的"}},[t._v("#")]),t._v(" JAVASCRIPT 为什么是单线程的?")]),t._v(" "),n("ul",[n("li",[t._v("作为浏览器脚本语言，"),n("strong",[t._v("JavaScript 的主要用途是与用户互动，以及操作 DOM")]),t._v(",决定了 js 只能为单线程")]),t._v(" "),n("li",[t._v("比如，假定 JavaScript 同时有两个线程，一个线程在某个 DOM 节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("为了利用多核 CPU 的计算能力，HTML5 提出 Web Worker 标准，允许 JavaScript 脚本创建多个线程，但是"),n("strong",[t._v("子线程完全受主线程控制")]),t._v("，且不得操作 DOM。所以，这个新标准并没有改变 JavaScript 单线程的本质")])]),t._v(" "),n("h2",{attrs:{id:"什么是异步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是异步"}},[t._v("#")]),t._v(" 什么是异步")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("什么是异步")]),t._v(" "),n("p",[t._v("代码在执行过程中，会遇到一些无法立即处理的任务，比如以下；")]),t._v(" "),n("ul",[n("li",[t._v("计时完成后需要执行的任务 -- setTimeout、setInterval")]),t._v(" "),n("li",[t._v("网络通信完成后需要执行的任务 -- XHR、Featch")]),t._v(" "),n("li",[t._v("用户操作后需要执行的任务 -- addEventListener")])]),t._v(" "),n("p",[t._v("如果让渲染线程等待这些任务的执行时机没达到、就会导致主线程长期处于【阻塞】的状态，从而导致浏览器【卡死】")])]),t._v(" "),n("h2",{attrs:{id:"为什么需要异步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要异步"}},[t._v("#")]),t._v(" 为什么需要异步？")]),t._v(" "),n("p",[t._v("单线程只能自上而下执行，如果上一行解析时间很长,那么下面的代码就会被阻塞，不向下执行。会造成页面卡死现象。")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("面试题：如何理解js中的异步?")]),t._v(" "),n("ul",[n("li",[t._v("Js是一门单线程语言，这是因为它运行在浏览器的渲染主线程中，而渲染主线程只有一个。而渲染主线程又承担着诸多工作，例如渲染页面【布局、计算样式、处理图层】、事件处理、执行js、回调、解析HTML等等。\n如果使用同步的方式，就极有可能使主线程，产生阻塞，从而使消息队列中的很多其他任务无法执行。这样一来主线程中就会因为阻塞浪费时间。\n导致页面无法及时更新，造成页面卡顿的现象。")]),t._v(" "),n("li",[t._v("所以浏览器采用异步的方式避免，具体做法就是当某些任务例【计时器、网络请求、事件监听】主线程将任务交给其他线程去处理，自身立即结束任务的执行，\n从而去执行后续代码。当其他线程完成时，将事先传递的回调函数包装成任务，加入到消息队列的末尾排队，等待主线程调用执行。")]),t._v(" "),n("li",[t._v("在这种异步的模式下，浏览器不阻塞，最大限度的保证了主线程的流畅运行。")])])]),t._v(" "),n("h2",{attrs:{id:"单线程又是如何实现异步的呢"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单线程又是如何实现异步的呢"}},[t._v("#")]),t._v(" 单线程又是如何实现异步的呢?")]),t._v(" "),n("p",[n("strong",[t._v("通过事件循环实现异步")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(508),alt:"事件循环"}})]),t._v(" "),n("p",[t._v("::： tip 面试：简述事件循环")]),t._v(" "),n("ul",[n("li",[t._v("事件循环又叫消息循环，是浏览器主线程的工作方式。")]),t._v(" "),n("li",[t._v("在Chrome源码中，  开启了一个不会结束的for循环，每次循环从消息队列中取出第一个任务，而其他线程只需要在合适的时间将任务添加到队列末尾即可。")]),t._v(" "),n("li",[t._v("过去把消息队列分为宏队列和微队列，根据W3c最新的解释来看，每个任务有不同的类型，"),n("strong",[t._v("同类型的任务必须在同一个队列中，不同的任务可以属于不同的队列。")])]),t._v(" "),n("li",[t._v("不同任务队列有不同的优先级，在一次事件循环中，由浏览器自行决定取哪一个队列的任务，但浏览器必须有一个微队列，微队列的任务一定具有最高的优先级，必须优先调度执行\n:::")])]),t._v(" "),n("h2",{attrs:{id:"宏任务-微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#宏任务-微任务"}},[t._v("#")]),t._v(" 宏任务&微任务")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("宏任务(macro-task)")]),t._v(" "),n("th",[t._v("微任务(micro-task)")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("整体的script代码")]),t._v(" "),n("td",[t._v("promise.[ then/catch/finally ]((非new Promise))")])]),t._v(" "),n("tr",[n("td",[t._v("setTimeout")]),t._v(" "),n("td",[t._v("process.nextTick(Node.js 环境)")])]),t._v(" "),n("tr",[n("td",[t._v("setInterval")]),t._v(" "),n("td",[t._v("MutaionOberver（浏览器环境）")])]),t._v(" "),n("tr",[n("td",[t._v("setImmediate(Node.js 环境)")]),t._v(" "),n("td",[t._v("Object.observe")])]),t._v(" "),n("tr",[n("td",[t._v("IO操作")]),t._v(" "),n("td",[t._v("x")])]),t._v(" "),n("tr",[n("td",[t._v("UI交互事件")]),t._v(" "),n("td",[t._v("x")])]),t._v(" "),n("tr",[n("td",[t._v("postMessage")]),t._v(" "),n("td",[t._v("x")])]),t._v(" "),n("tr",[n("td",[t._v("MessageChannel")]),t._v(" "),n("td",[t._v("x")])])])]),t._v(" "),n("h3",{attrs:{id:"宏任务-macro-task"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#宏任务-macro-task"}},[t._v("#")]),t._v(" 宏任务（macro-task）")]),t._v(" "),n("p",[t._v("整体代码 script、setTimeOut、setInterval、setImmediate")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[n("strong",[t._v("setImmediate()只有一个的时候永远最后执行，多个的时候每次循环只执行一个")])])]),t._v(" "),n("h3",{attrs:{id:"微任务-micro-task"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微任务-micro-task"}},[t._v("#")]),t._v(" 微任务（micro-task）")]),t._v(" "),n("p",[t._v("Promise 的回调(promise.then) 、async/await、"),n("strong",[t._v("process.nextTick()永远最先执行，存在多个的时候先进先出")])]),t._v(" "),n("h4",{attrs:{id:"单个-setimmediate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单个-setimmediate"}},[t._v("#")]),t._v(" 单个 setImmediate()")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setTimeout"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nprocess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出 3 2 4 setTimeout 1")]),t._v("\n")])])]),n("p",[n("strong",[t._v("分析执行过程")])]),t._v(" "),n("ul",[n("li",[t._v("1、"),n("code",[t._v("setTimeout")]),t._v(" 异步任务进入 "),n("code",[t._v("event table")])]),t._v(" "),n("li",[t._v("2、"),n("code",[t._v("setImmediate")]),t._v(" 异步任务进入 "),n("code",[t._v("event table")])]),t._v(" "),n("li",[t._v("3、"),n("code",[t._v("process.nextTick")]),t._v(" 异步任务进入 "),n("code",[t._v("event table")])]),t._v(" "),n("li",[t._v("4、"),n("code",[t._v("promise")]),t._v(" 同步任务执行 "),n("code",[t._v("console.log(3)")]),t._v(", "),n("code",[t._v(".then回调")]),t._v("异步任务 进入"),n("code",[t._v("event table")])]),t._v(" "),n("li",[t._v("5、此时同步任务执行完毕，"),n("strong",[t._v("优先执行微任务 process.nextTick")]),t._v(" 该任务被推入 "),n("code",[t._v("event loop")]),t._v(" ，经判断 主线程为空，则进入主线程执行。")]),t._v(" "),n("li",[t._v("6、"),n("code",[t._v("then()回调函数")]),t._v(" 为微任务 等待 "),n("code",[t._v("process.nextTick")]),t._v(" 结束 执行")]),t._v(" "),n("li",[t._v("7、执行宏任务 "),n("code",[t._v("setTimeout")])]),t._v(" "),n("li",[t._v("8、"),n("code",[t._v("setImmediate")]),t._v(" 最后执行")])]),t._v(" "),n("h4",{attrs:{id:"多个-setimmediate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多个-setimmediate"}},[t._v("#")]),t._v(" 多个 setImmediate()")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setTimeout"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nprocess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输出结果：  3 2 4 setTimeout 1 5 6 9 7")]),t._v("\n")])])]),n("p",[t._v("分析执行过程")]),t._v(" "),n("ul",[n("li",[t._v("1、"),n("code",[t._v("setTimeout")]),t._v("宏任务进入 "),n("code",[t._v("event table")]),t._v(" 记作"),n("code",[t._v("setTimeout1")])]),t._v(" "),n("li",[t._v("2、"),n("code",[t._v("setImmediate")]),t._v(" 微任务 进入 "),n("code",[t._v("event table")]),t._v(" 记作"),n("code",[t._v("setImmediate1")])]),t._v(" "),n("li",[t._v("3、"),n("code",[t._v("process.nextTick")]),t._v(" 微任务 进入 "),n("code",[t._v("event table")]),t._v(" 记作 "),n("code",[t._v("process1")])]),t._v(" "),n("li",[t._v("4、"),n("code",[t._v("promise")]),t._v(" 执行 console.log(3) "),n("code",[t._v("then()回调 微任务")]),t._v(" 进入 "),n("code",[t._v("event table")]),t._v("记作 "),n("code",[t._v("promise1")])]),t._v(" "),n("li",[t._v("5、"),n("code",[t._v("setImmediate")]),t._v(" 微任务 进入 "),n("code",[t._v("event table")]),t._v(" 记作"),n("code",[t._v("setImmediate2")]),t._v("\nevent table:\n"),n("table",[n("thead",[n("tr",[n("th",[t._v("宏任务")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("微任务")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("setTimeout1")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("setImmediate1")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("process1")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("promise1")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("setImmediate2")])])])])])]),t._v(" "),n("p",[n("strong",[t._v("第一轮执行结束输出 3")])]),t._v(" "),n("p",[n("strong",[t._v("第二轮开始")])]),t._v(" "),n("ul",[n("li",[t._v("1、"),n("code",[t._v("process.nextTick")]),t._v(" 在第一轮执行过程中已经 存在 "),n("code",[t._v("event table")]),t._v("了，由于它在循环开始执行，故"),n("code",[t._v("优先执行 process1")]),t._v(" "),n("ul",[n("li",[t._v("1、 "),n("code",[t._v("setImmediate")]),t._v(" 微任务进入 "),n("code",[t._v("event table")]),t._v("记作"),n("code",[t._v("setImmediate3")])]),t._v(" "),n("li",[t._v("2、 执行 console.log(2)")])])]),t._v(" "),n("li",[t._v("2、执行当前"),n("code",[t._v("event table")]),t._v("中的 微任务 promise1 的 then()回调函数"),n("code",[t._v("console.log(4)")])]),t._v(" "),n("li",[t._v("3、执行当前"),n("code",[t._v("event table")]),t._v("中的 宏任务 "),n("code",[t._v("setTimeout1")]),t._v(" "),n("ul",[n("li",[t._v("1、 执行 console.log(‘setTimeout’)")]),t._v(" "),n("li",[t._v("2、"),n("code",[t._v("setImmediate")]),t._v(" 进入 event lable"),n("code",[t._v("记作")]),t._v("setImmediate4`")])])]),t._v(" "),n("li",[t._v("4、"),n("code",[t._v("setImmediate 最后执行")]),t._v(" 故执行 "),n("code",[t._v("setImmediate1")]),t._v(" "),n("ul",[n("li",[t._v("1、执行 console.log(1)")]),t._v(" "),n("li",[t._v("2、"),n("code",[t._v("setImmediate")]),t._v(" 进入 "),n("code",[t._v("event lable")]),t._v(" 记作 "),n("code",[t._v("setImmediate5")])])])]),t._v(" "),n("li",[t._v("5、event table 中还有 setImmediate2 执行 console.log(5)\n"),n("table",[n("thead",[n("tr",[n("th",[t._v("宏任务")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("微任务")])])]),t._v(" "),n("tbody",[n("tr",[n("td"),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("setImmediate3")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("setImmediate4")])]),t._v(" "),n("tr",[n("td"),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("setImmediate5")])])])])])]),t._v(" "),n("p",[n("strong",[t._v("第二轮 执行结束 结果为： 2 4 setTimeout 1 5; 进入第三轮")])]),t._v(" "),n("ul",[n("li",[t._v("1、执行 setImmediate3 中 console.log(6)")]),t._v(" "),n("li",[t._v("2、执行 setImmediate4 中 console.log(9)")]),t._v(" "),n("li",[t._v("3、执行 setImmediate5 中 console.log(7)")]),t._v(" "),n("li")]),t._v(" "),n("p",[n("strong",[t._v("第三轮 的执行结果为 6 9 7 至此 该程序执行完毕")])]),t._v(" "),n("h3",{attrs:{id:"执行顺序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行顺序"}},[t._v("#")]),t._v(" 执行顺序")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),n("ul",[n("li",[t._v("1、渲染主线程")]),t._v(" "),n("li",[t._v("2、微队列")]),t._v(" "),n("li",[t._v("3、延时队列")]),t._v(" "),n("li",[t._v("4、交互队列")])])]),t._v(" "),n("ul",[n("li",[t._v("1、同步任务")]),t._v(" "),n("li",[t._v("2、promise.nextTick （Node 独有）")]),t._v(" "),n("li",[t._v("3、微任务")]),t._v(" "),n("li",[t._v("4、Dom 渲染")]),t._v(" "),n("li",[t._v("5、宏任务")]),t._v(" "),n("li",[t._v("6、setImmediate （Node 独有）")])])])}),[],!1,null,null,null);s.default=e.exports}}]);